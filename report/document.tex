\documentclass[11pt]{article}
\usepackage[top=2.54cm, bottom=2.54cm, left=2.75cm, right=2.75cm]{geometry}
\linespread{1.2}
\setlength{\parindent}{0cm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{datetime}
\usepackage{graphicx}
\usepackage{float}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{hyperref}
\bibliographystyle{ieeetr}

\newcommand{\vd}{\mathrm{d}} %Vertical d (for derivatives)

\begin{document}
	\pagenumbering{arabic}
	
	\begin{titlepage}
		\begin{center}
			{\Huge Monte Carlo Simulations of The Ising Model}\\[0.5cm]
			\textit{Haodong Chang and Tavis O'Reilly}\\[0.3cm]
			\textit{11505303 and 10903943}\\[0.3cm]
			Department of Physics and Astronomy\\[0.3cm]
			University of Manchester\\[0.3cm]
			PHYS20872 Theory Computing Project\\[0.3cm]
			\shortmonthname[\the\month]  \the\year \\[4cm]
			
		\end{center}
		
		{\Large \textbf{Abstract}}\\[0.3cm]
		The goal of this project was to use a Metropolis-Hastings algorithm, a type of Markov chain Monte Carlo method, to simulate the Ising model for ferromagnetism. In two dimensions, an exact analytic solution exists\cite{onsager_solution} that shows a phase transition at the critical temperature $T_c$. We wrote a computer simulation that implements a Metropolis-Hastings algorithm to find the average energy, heat capacity and magnetisation as a function of temperature. \\
		
		How our results it fits with the predictions of the model
		
	\end{titlepage}
	
	\pagenumbering{gobble}
	\clearpage
	\pagenumbering{arabic}
	\setcounter{page}{2}
	
	\newpage
	
	\section{Introduction}
	
	The Ising model is a simple model of ferromagnetism, consisting of a grid of atomic spins that can either be "up" or "down". These spins only interact with their nearest neighbours, and with any external magnetic field. The Ising model can be difficult to solve analytically so numerical methods can be favourable to obtain solutions instead. \\
	
	Expand further:
	\begin{itemize}
		\item Relevance/uses?
		\item Briefly explain temperature and energy in the model.
	\end{itemize}
	
	\section{Theory}

	Let's consider a simple model of spins on a lattice.
	Each spin can be in one of two states, up or down, which we will represent by $s_i = \pm 1$.

	Every spin interacts with its nearest neighbours, and each pair contributes $-J s_i s_j$ to the energy, 
	where $J$ is a constant representing the strength of the interaction.

	There is also an external magnetic field, represented by $h$.
	Every spin in the magnetic field contributes $-h s_i$ to the total energy.

	A figure showing 1D and 2D lattices with spins (to be added).

	Thus, the total energy of the system is given by
	\begin{equation} \label{eq:Hamiltonian}
		H(\{s_i\}) = -J \sum_{\langle i,j \rangle} s_i s_j - h \sum_i s_i
	\end{equation}
	where the first sum is over all pairs of nearest neighbours, and the second sum is over all spins.
	We may call the total energy as Hamiltonian in the following.
	
	Our calculation and simulation will be dealt in the canonical ensemble, where the temperature $T$ is fixed.

	By now, we have encountered every ingredient of the Ising model: 
	shape of the lattice $\langle i,j \rangle$, interaction strength $J$, external magnetic field $h$, and temperature $T$.
	
	Given these, we can calculate the partition function of the system, which is the key to all thermodynamic properties.
	\begin{equation} \label{eq:PartitionFunction}
		Z = \sum_{\{s_i\}} e^{-\beta H(\{s_i\})}, \quad \beta = \frac{1}{k_B T}
	\end{equation}
	The canonical ensemble assigns a probability to each state $\{s_i\}$ given by
	\begin{equation} \label{eq:Probability}
		P(\{s_i\}) = \frac{e^{-\beta H(\{s_i\})}}{Z}
	\end{equation}
	As you can see, states with lower energy are more likely to be found.

	Then we can discuss the meaning of $J$ and $h$.
	\begin{itemize}
		\item If $J > 0$, neighbours with parallel spins have lower energy, so the system tends to be aligned, which is called ferromagnetic.
		\item If $J < 0$, neighbouring spins tend to be antiparallel, which is called anti-ferromagnetic.
	\end{itemize}
	\begin{itemize}
		\item If $h > 0$, spins prefer to be $s_i = +1$.
		\item If $h < 0$, spins prefer to be $s_i = -1$.
	\end{itemize}
	We can see that spins tend to align with the magnetic field, which is called paramagnetic.

	% (Briefly mention the concept of phase transitions. Add or not?)

	In the following of the theory section, we will start from some simple cases, and then generalize to more complex ones.

	\subsection{Ising Model without interaction ($J=0$)}

	When there is no interaction between spins, the shape of the lattice doesn't matter at all, and the Hamiltonian becomes
	\begin{equation} \label{eq:HamiltonianNoInteraction}
		H(\{s_i\}) = -h \sum_i s_i
	\end{equation}
	which is simply the energy of a collection of spins in a magnetic field.

	Then the partition function is
	\begin{equation} \label{eq:PartitionFunctionNoInteraction}
		\begin{aligned}
			Z &= \sum_{\{s_i\}} e^{-\beta H(\{s_i\})} = \sum_{\{s_i\}} e^{\beta h \sum_i s_i} = \prod_i \sum_{s_i=\pm1} e^{\beta h s_i} \\
			&= \prod_i (e^{\beta h} + e^{-\beta h}) = (e^{\beta h} + e^{-\beta h})^N = (2\cosh(\beta h))^N
		\end{aligned}
	\end{equation}

	The energy of the system can be calculated as
	\begin{equation} \label{eq:EnergyNoInteraction}
		E \equiv \langle H \rangle = -\frac{\partial}{\partial \beta} \ln Z = - N h \tanh(\beta h)
	\end{equation}

	Here because of the absence of interaction, the relation between energy and magnetisation is simple, and we have
	\begin{equation} \label{eq:MagnetisationNoInteraction}
		M \equiv \langle \sum_i s_i \rangle = -\frac{E}{h} = N \tanh(\beta h)
	\end{equation}

	\subsection{1D Ising Model without external field ($h=0$)}

	% (To be added: a figure)

	In this case, the Hamiltonian becomes
	\begin{equation} \label{eq:Hamiltonian1DNoField}
		H(\{s_i\}) = -J \sum_{i=1}^{N-1} s_i s_{i+1}
	\end{equation}

	The interaction makes it difficult to calculate the partition function, 
	but considering what we have done for the 1D Ising model without interaction, 
	we can transform the case into a non-interacting one by introducing some new variables $p_i = s_i s_{i+1}$.
	Here $\{s_1, s_2, \cdots, s_N\}$ and $\{s_1, p_1, p_2, \cdots, p_{N-1}\}$ are equivalent descriptions of the system.
	The inverse transform is simply $s_i = s_1 \prod_{j=1}^{i-1} p_j$.
	Then the Hamiltonian becomes
	\begin{equation} \label{eq:Hamiltonian1DNoFieldTransformed}
		H(s_1, \{p_i\}) = -J \sum_{i=1}^{N-1} p_i
	\end{equation}

	Applying the result of equation \ref{eq:PartitionFunctionNoInteraction}, we have the partition function
	\begin{equation} \label{eq:PartitionFunction1DNoField}
		\begin{aligned}
			Z &= \sum_{s_1, \{p_i\}} e^{-\beta H(s_1, \{p_i\})} \\
			&= 2(2\cosh(\beta J))^{N-1}
		\end{aligned}
	\end{equation}
	The factor 2 comes from the two possible values of $s_1$.

	The boundary conditions (B.C.) here needs to be specified.
	Our discussion just now is based on free-end B.C., where the first and last spins are not connected.
	Another common choice is periodic boundary conditions (PBC), which means $s_{N+1} = s_1$, and the Hamiltonian becomes
	\begin{equation} \label{eq:Hamiltonian1DNoFieldPeriodic}
		H(\{s_i\}) = -J \sum_{i=1}^{N} s_i s_{i+1}
	\end{equation}

	Similarly, we can transform $\{s_1, s_2, \cdots, s_N\}$ into $\{s_1, p_1, p_2, \cdots, p_{N-1}\}$, 
	and calculate the partition function under PBC
	\begin{equation} \label{eq:PartitionFunction1DNoFieldPeriodic}
		Z = (2\cosh(\beta J))^N(1 + (\tanh(\beta J))^N)
	\end{equation}

	The advantage of PBC over free-end B.C. is that no spin is special.
	When the lattice is large enough ($N \to \infty$), they show no difference.

	\subsection{General 1D Ising model($J\neq0, h\neq0$)}

	First, let's consider a simple Ising model with only two spins under PBC.
	The Hamiltonian is
	\begin{equation} \label{eq:Hamiltonian1DGeneral2Spins}
		H(s_1, s_2) = -J s_1 s_2 - J s_2 s_1 - hs_1 - hs_2
	\end{equation}

	Define a matrix $P$, we can see why we need it later.
	\begin{equation} \label{eq:MatrixP}
		P = \begin{pmatrix}
			e^{\beta(J+h)} & e^{-\beta J} \\
			e^{-\beta J} & e^{\beta(J-h)}
		\end{pmatrix}
	\end{equation}

	Then the partition function is
	\begin{equation} \label{eq:PartitionFunction1DGeneral2Spins}
		Z = \sum_{s_1, s_2} e^{-\beta H(s_1, s_2)} = \mathrm{Tr}(P \cdot P)
	\end{equation}
	Here $\mathrm{Tr}$ denotes the trace of a matrix.

	One can easily verify the above result by expanding the matrix product, 
	but may be curious about why we need such a matrix $P$.
	Actually, the matrix $P$ indicates the "connection" between the two spins.

	Suppose that the first row and column of $P$ represent a state $s = +1$, 
	while the second row and column represent another state $s = -1$.
	We can write down the elements of $P$ as
	\begin{equation} \label{eq:MatrixPElements}
		P_{+,+} = e^{\beta(J+h)}, \quad P_{+,-} = P_{-,+} = e^{-\beta J}, \quad P_{-,-} = e^{\beta(J-h)}
	\end{equation}

	The contribution of the connection between two spins to the partition function is
	\begin{equation} \label{eq:PartitionFunction1DGeneral2SpinsConnection}
		P_{s_1, s_2} = e^{\beta(J s_1 s_2 + \frac12h(s_1 + s_2))}
	\end{equation}
	The factor $\frac12$ here is because each spin will be counted twice in two connections it has.

	We can write down the partition function of such a system with $2$ spins as
	\begin{equation} \label{eq:PartitionFunction1DGeneral2SpinsConnectionSum}
		\begin{aligned}
		Z &= \sum_{s_1, s_2} e^{-\beta H(s_1, s_2)} = \sum_{s_1, s_2} e^{\beta(2J s_1 s_2 + h(s_1 + s_2))} \\
		&= \sum_{s_1, s_2} e^{\beta(J s_1 s_2 + \frac12h(s_1 + s_2))} \cdot e^{\beta(J s_1 s_2 + \frac12h(s_1 + s_2))} \\
		&= \sum_{s_1, s_2} P_{s_1, s_2} \cdot P_{s_2, s_1} \\
		&= \mathrm{Tr}(P \cdot P)
		\end{aligned}
	\end{equation}

	It's easy to generalize the result to a system with $N$ spins.
	\begin{equation} \label{eq:PartitionFunction1DGeneral}
		\begin{aligned}
			Z &= \sum_{\{s_i\}} e^{-\beta H(\{s_i\})} = \sum_{\{s_i\}} \prod_{i=1}^{N} e^{\beta(J s_i s_{i+1} + \frac12h(s_i + s_{i+1}))} \\
			&= \sum_{\{s_i\}} \prod_{i=1}^{N} P_{s_i, s_{i+1}} = \mathrm{Tr}(P^N) \\
		\end{aligned}
	\end{equation}

	Now our task is simplified into calculating the trace of the $N$-th power of a $2 \times 2$ matrix $P$.
	Mathematicians have already solved this problem by diagonalizing the matrix
	\begin{equation} \label{eq:MatrixPDiagonal}
		P = U \cdot D \cdot U^\dagger
	\end{equation}
	Here $U$ is a unitary matrix, which means $U^\dagger U = I$, and $D$ is a diagonal matrix.
	It has been proven that such diagonalization is always possible for a Hermitian matrix like $P$.

	Then the $N$-th power of $P$ is
	\begin{equation} \label{eq:MatrixPN}
		P^N = U \cdot D^N \cdot U^\dagger
	\end{equation}

	We only care about the trace of $P^N$
	\begin{equation} \label{eq:MatrixPNTrace}
		\begin{aligned}
			\mathrm{Tr}(P^N) &= \mathrm{Tr}(U \cdot D^N \cdot U^\dagger) \\
			&= \mathrm{Tr}((U \cdot D^N) \cdot U^\dagger) = \mathrm{Tr}(U^\dagger \cdot (U \cdot D^N)) \\
			&= \mathrm{Tr}(D^N)
		\end{aligned}
	\end{equation}

	For a diagonal matrix $D = \mathrm{diag}(\lambda_+, \lambda_-)$, 
	its $N$-th power is also a diagonal matrix $D^N = \mathrm{diag}(\lambda_+^N, \lambda_-^N)$.
	Thus, we have
	\begin{equation} \label{eq:MatrixPNTraceDiagonal}
		\mathrm{Tr}(P^N) = \lambda_+^N + \lambda_-^N
	\end{equation}

	Now we only need to find $\lambda_\pm$, which are the eigenvalues of $P$.
	I used Mathematica to calculate them, and the result is
	\begin{equation} \label{eq:MatrixPEigenvalues}
		\lambda_\pm = e^{\beta J} \left[\cosh(\beta h) \pm \sqrt{e^{-4\beta J}+\sinh^2(\beta h)}\right]
	\end{equation}

	Finally, we have the partition function of a 1D Ising model with $N$ spins
	\begin{equation} \label{eq:PartitionFunction1DGeneralFinal}
		\begin{aligned}
			Z &= \mathrm{Tr}(P^N) = \lambda_+^N + \lambda_-^N \\
			&= e^{N \beta J} \left\{\left[\cosh(\beta h) + \sqrt{e^{-4\beta J}+\sinh^2(\beta h)}\right]^N
			 + \left[\cosh(\beta h) - \sqrt{e^{-4\beta J}+\sinh^2(\beta h)}\right]^N\right\}
		\end{aligned}
	\end{equation}

	Now we can make some discussions over this equation.
	\begin{itemize}
		\item When $J = 0$, equation \eqref{eq:PartitionFunction1DGeneralFinal} reduces to equation \eqref{eq:PartitionFunctionNoInteraction},
			which is the partition function of a system without interaction.
		\item We didn't provide the derivation of equation \eqref{eq:PartitionFunction1DNoFieldPeriodic} in section 2.2,
			but now it can be obtained by setting $h = 0$ in equation \eqref{eq:PartitionFunction1DGeneralFinal}.
		\item In the limit $N \to \infty$, we have $\lambda_+^N \gg \lambda_-^N$, and the partition function becomes
			\begin{equation} \label{eq:PartitionFunction1DGeneralLimit}
				Z \approx \lambda_+^N = e^{N \beta J} \left[\cosh(\beta h) + \sqrt{e^{-4\beta J}+\sinh^2(\beta h)}\right]^N
			\end{equation}
		It will be much easier for us to calculate energy $E$, heat capacity $C_V$, magnetisation $M$, 
		and other thermodynamic properties under such approximation.
	\end{itemize}

	\subsection{2D Ising Model}
	
	\subsubsection*{Onsager's Solution}
	
	Source\cite{onsager_solution}
	
	\begin{equation}
		\begin{split}
			Z &= \lambda^N \\
			\ln{\lambda} &= \ln{\left(2 \cosh{2\beta J}\right)} + \frac{1}{\pi}\int_0^{\frac{\pi}{2}} \ln{\left[\frac{1}{2}\left(1 + \sqrt{1 - K^2\sin^2{w}}\right)\right]\;\vd w} \\
			K &= \frac{2\sinh{2\beta J}}{\left(\cosh{2\beta J}\right)^2}
		\end{split}
	\end{equation}
	
	Energy:
	\begin{equation}
		\begin{split}
			E &= - \frac{\partial \ln{Z}}{\partial \beta} = -N\frac{\partial \ln{\lambda}}{\partial \beta}
		\end{split}
	\end{equation}
	
	\section{Implementation}
	
	The first step was to create a grid of spins. We opted to have the spins randomly distributed but with a bias towards the "up" direction. This ensured the magnetisation, which is sensitive to initial conditions, approached the same average each time.\\
	
	The basic algorithm that is then used is:
	\begin{enumerate}
		\item Choose a spin at random from the grid.
		\item Calculate the energy change $\Delta E$ if this spin were to flip.
		\item If $\Delta E \leq 0$ flip the spin, otherwise flip the spin with probability $e^{-\beta\Delta E}$.
		\item Repeat this process.
	\end{enumerate}
	
	In our setup, the energy was calculated using a periodic boundary condition. Starting in two dimensions, we ran some initial tests of the model to observe the behaviour of the spins as the algorithm iterates, as shown in figure \ref{fig:ising_grid}.
	\begin{figure}[H]
		\begin{center}
			\includegraphics[width=0.5\textwidth]{./img/ising-simulation.png}
		\end{center}
		\caption{A two-dimensional Ising Model simulation on a $500\times 500$ grid with parameters $J = 1.0$, $\beta = 1.0$ and $h = 0$.}
		\label{fig:ising_grid}
	\end{figure}
	
	In order to compare to the Onsager solution, we needed to run the same simulation for a number of different values of $\beta$. The simulation needs to be run for a sufficient number of iterations such that it reaches equilibrium. Our stopping condition was the following:
	\begin{itemize}
		\item For each block of $n$ iterations:
		\begin{enumerate}
			\item Calculate the mean of the current block.
			\item Compare the change of the mean value from the current block to that of the previous block.
			\item If the mean has changed by less than three times the standard deviation of the mean $\displaystyle\left(\frac{\sigma}{\sqrt{n}}\right)$, it is considered to be at equilibrium and the simulation stops.
		\end{enumerate}
		\item There is also a set maximum iterations $N_\text{max}$ to ensure the algorithm doesn't continue ad infinitum.
	\end{itemize}
	
	\section{Results}
	
	After running the algorithm described above for a grid size of $1000 \times 1000$, for values of $k_B T$ between $0.0001$ and $4.0\;\mathrm{J}$, we obtained the data shown in figure [].
	\begin{figure}[H]
		\begin{center}
			\begin{tikzpicture}
				\begin{axis}[width=0.8\textwidth, height=0.5\textwidth, xlabel=$k_BT$, ylabel=$E/N$]
					\addplot [mark size=0pt,blue] table[
					col sep=comma,
					x=temp,
					y=energy]
					{csv/onsager-energy.csv};
					
					\addplot [mark=*,mark size=0.5pt,black] table[
					col sep=comma,
					x=temp,
					y=energy,
					only marks]
					{csv/energy-1000.csv};
				\end{axis}
			\end{tikzpicture}
		\end{center}
		\caption{A plot of the average energy per particle against $k_BT$. The blue line is the solution obtained from the Onsager solution, and the black points are the data calculated by our simulation.}
	\end{figure}
	
	\section{Conclusion}
	
	Conclude results.
	
	\newpage
	\bibliography{references} 
	\bibliographystyle{ieeetr}

\end{document}